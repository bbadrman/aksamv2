{% extends 'base.html.twig' %}

{% block title %}Traiter SAV
{% endblock %}

{% block body %}
	<style>:root
	{
		--primary-color: #2c3e50;
		--secondary-color: #3498db;
		--accent-color: #e74c3c;
		--success-color: #27ae60;
		--warning-color: #f39c12;
		--light-bg: #f8f9fa;
		--card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
		--border-radius: 12px;
	}

	body {
		background-color: var(--light-bg);
		font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		line-height: 1.6;
	}

	.header-section {
		background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
		color: white;
		padding: 2rem 0;
		margin-bottom: 2rem;
		border-radius: 0 0 var(--border-radius) var(--border-radius);
		box-shadow: var(--card-shadow);
	}

	.header-section h1 {
		font-size: 2.5rem;
		font-weight: 300;
		margin: 0;
	}

	.sav-icon {
		width: 80px;
		height: 80px;
		background: rgba(255, 255, 255, 0.2);
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		margin: 0 auto 1rem;
		font-size: 2rem;
	}

	.info-card {
		background: white;
		border-radius: var(--border-radius);
		box-shadow: var(--card-shadow);
		margin-bottom: 2rem;
		overflow: hidden;
		transition: transform 0.2s ease;
	}

	.info-card:hover {
		transform: translateY(-2px);
		box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
	}

	.card-header {
		background: linear-gradient(90deg, var(--secondary-color), #5dade2);
		color: white;
		padding: 1rem 1.5rem;
		font-weight: 600;
		font-size: 1.1rem;
		border: none;
	}

	.card-header i {
		margin-right: 0.5rem;
	}

	.card-body {
		padding: 1.5rem;
	}

	.custom-table {
		margin: 0;
		border: none;
	}

	.custom-table th {
		background-color: #f8f9fa;
		border: none;
		padding: 0.75rem 1rem;
		font-weight: 600;
		color: var(--primary-color);
		width: 35%;
	}

	.custom-table td {
		border: none;
		padding: 0.75rem 1rem;
		border-top: 1px solid #e9ecef;
	}

	.custom-table tbody tr:hover {
		background-color: #f8f9fa;
	}

	.status-badge {
		padding: 0.25rem 0.75rem;
		border-radius: 20px;
		font-size: 0.85rem;
		font-weight: 500;
	}

	.status-avenant {
		background-color: #e3f2fd;
		color: #1976d2;
	}
	.status-remboursement {
		background-color: #e8f5e8;
		color: #388e3c;
	}
	.status-sinistre {
		background-color: #ffebee;
		color: #d32f2f;
	}
	.status-documents {
		background-color: #fff3e0;
		color: #f57c00;
	}
	.status-autre {
		background-color: #f3e5f5;
		color: #7b1fa2;
	}

	.treatment-section {
		background: white;
		border-radius: var(--border-radius);
		box-shadow: var(--card-shadow);
		padding: 2rem;
		margin-bottom: 2rem;
	}

	.form-group {
		margin-bottom: 1.5rem;
	}

	.form-control {
		border-radius: 8px;
		border: 2px solid #e9ecef;
		padding: 0.75rem;
		transition: border-color 0.2s ease;
	}

	.form-control:focus {
		border-color: var(--secondary-color);
		box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
	}

	.btn-custom {
		border-radius: 8px;
		padding: 0.75rem 2rem;
		font-weight: 600;
		transition: all 0.2s ease;
		border: none;
		margin: 0.25rem;
	}

	.btn-primary-custom {
		background: linear-gradient(135deg, var(--secondary-color), #5dade2);
		color: white;
	}

	.btn-primary-custom:hover {
		transform: translateY(-1px);
		box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
	}

	.btn-secondary-custom {
		background: #6c757d;
		color: white;
	}

	.btn-secondary-custom:hover {
		background: #545b62;
		transform: translateY(-1px);
	}

	.history-table {
		background: white;
		border-radius: var(--border-radius);
		overflow: hidden;
	}

	.history-table th {
		background: var(--primary-color);
		color: white;
		border: none;
		padding: 1rem;
		font-weight: 600;
	}

	.history-table td {
		padding: 0.75rem 1rem;
		border-top: 1px solid #e9ecef;
	}

	.history-table tbody tr:nth-child(even) {
		background-color: #f8f9fa;
	}

	.history-table tbody tr:hover {
		background-color: #e3f2fd;
	}

	.section-divider {
		height: 2px;
		background: linear-gradient(90deg, var(--secondary-color), transparent);
		margin: 2rem 0;
		border-radius: 1px;
	}

	@media(max-width: 768px) {
		.header-section h1 {
			font-size: 2rem;
		}

		.card-body {
			padding: 1rem;
		}

		.custom-table th,
		.custom-table td {
			padding: 0.5rem;
			font-size: 0.9rem;
		}

		.treatment-section {
			padding: 1rem;
		}
	}

	.alert-custom {
		border: none;
		border-radius: var(--border-radius);
		background: linear-gradient(135deg, #f8f9fa, #e9ecef);
	}
</style>

<!-- Header Section -->
<div class="header-section">
	<div class="container">
		<div class="text-center">
			<div class="sav-icon">
				<i class="fas fa-tools"></i>
			</div>
			<h1>Service Après-Vente</h1>
			<p class="mb-0">Gestion et traitement des demandes SAV</p>
		</div>
	</div>
</div>

<div class="container">
	<div
		class="row">
		<!-- Informations Contrat -->
		<div class="col-lg-6 col-xl-4">
			<div class="info-card">
				<div class="card-header">
					<i class="fas fa-file-contract"></i>
					Informations Contrat
				</div>
				<div class="card-body">
					<table class="table custom-table">
						<tbody>
							<tr>
								<th>
									<i class="fas fa-user me-2"></i>Nom et Prénom</th>
								<td>
									<strong>{{ sav.contrat.nom }}
										{{ sav.contrat.prenom }}</strong>
								</td>
							</tr>
							<tr>
								<th>
									<i class="fas fa-user-tie me-2"></i>Commercial</th>
								<td>{{ sav.contrat.user }}</td>
							</tr>
							<tr>
								<th>
									<i class="fas fa-box me-2"></i>Produit</th>
								<td>{{ sav.contrat.product }}</td>
							</tr>
							<tr>
								<th>
									<i class="fas fa-calendar me-2"></i>Date Effet</th>
								<td>{{ sav.contrat.dateEffet ? sav.contrat.dateEffet|date('d/m/Y H:i:s') : '' }}</td>
							</tr>
							<tr>
								<th>
									<i class="fas fa-id-card me-2"></i>Immatriculation</th>
								<td>{{ sav.contrat.imatriclt }}</td>
							</tr>
							<tr>
								<th>
									<i class="fas fa-euro-sign me-2"></i>Frais</th>
								<td>
									<strong>{{ sav.contrat.frais }}
										€</strong>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<!-- Informations SAV -->
		<div class="col-lg-6 col-xl-4">
			<div class="info-card">
				<div class="card-header">
					<i class="fas fa-info-circle"></i>
					Informations SAV
				</div>
				<div class="card-body">
					<table class="table custom-table">
						<tbody>
							<tr>
								<th>
									<i class="fas fa-clock me-2"></i>Date SAV</th>
								<td>{{ sav.creatAt ? sav.creatAt|date('d/m/Y H:i:s') : '' }}</td>
							</tr>
							<tr>
								<th>
									<i class="fas fa-tag me-2"></i>Motif</th>
								<td>
									{% if sav.motif is not empty %}
										{% if sav.motif == 1 %}
											<span class="status-badge status-avenant">
												<i class="fas fa-edit me-1"></i>
												Avenant
											</span>
										{% elseif sav.motif == 2 %}
											<span class="status-badge status-remboursement">
												<i class="fas fa-money-bill-wave me-1"></i>
												Remboursement
											</span>
										{% elseif sav.motif == 3 %}
											<span class="status-badge status-sinistre">
												<i class="fas fa-exclamation-triangle me-1"></i>
												Sinistre
											</span>
										{% elseif sav.motif == 4 %}
											<span class="status-badge status-documents">
												<i class="fas fa-file-alt me-1"></i>
												Demande documents
											</span>
										{% endif %}
									{% endif %}
								</td>
							</tr>
							<tr>
								<th>
									<i class="fas fa-list me-2"></i>Nature Demande</th>
								<td>
									{% if sav.natureDemande is not empty %}
										{% if sav.natureDemande == 1 %}
											<span class="status-badge status-avenant">
												<i class="fas fa-map-marker-alt me-1"></i>
												Changement adresse
											</span>
										{% elseif sav.natureDemande == 2 %}
											<span class="status-badge status-avenant">
												<i class="fas fa-university me-1"></i>
												Changement RIB
											</span>
										{% elseif sav.natureDemande == 3 %}
											<span class="status-badge status-avenant">
												<i class="fas fa-car me-1"></i>
												Changement véhicule
											</span>
										{% elseif sav.natureDemande == 4 %}
											<span class="status-badge status-documents">
												<i class="fas fa-folder me-1"></i>
												Frais dossier
											</span>
										{% elseif sav.natureDemande == 5 %}
											<span class="status-badge status-remboursement">
												<i class="fas fa-hand-holding-usd me-1"></i>
												Acompte
											</span>
										{% elseif sav.natureDemande == 6 %}
											<span class="status-badge status-remboursement">
												<i class="fas fa-calculator me-1"></i>
												Prorata suite résiliation
											</span>
										{% elseif sav.natureDemande == 7 %}
											<span class="status-badge status-sinistre">
												<i class="fas fa-plus-circle me-1"></i>
												Ouverture sinistre
											</span>
										{% elseif sav.natureDemande == 8 %}
											<span class="status-badge status-sinistre">
												<i class="fas fa-user-check me-1"></i>
												Mandaté expert
											</span>
										{% elseif sav.natureDemande == 9 %}
											<span class="status-badge status-remboursement">
												<i class="fas fa-money-check me-1"></i>
												Remboursement sinistre
											</span>
										{% elseif sav.natureDemande == 10 %}
											<span class="status-badge status-documents">
												<i class="fas fa-info me-1"></i>
												Relevé information
											</span>
										{% elseif sav.natureDemande == 11 %}
											<span class="status-badge status-documents">
												<i class="fas fa-certificate me-1"></i>
												Attestation
											</span>
										{% endif %}
									{% endif %}
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<!-- Formulaire de Traitement -->
		<div class="col-lg-12 col-xl-4">
			<div class="treatment-section">
				<div class="text-center mb-4">
					<h3>
						<i class="fas fa-cogs me-2"></i>Traitement</h3>
					<div class="section-divider"></div>
				</div>

				{{ form_start(form) }}
				{{ form_widget(form) }}
				<div class="text-center mt-4">
					<button class="btn btn-secondary-custom btn-custom" value="back" onclick="history.go(-1)">
						<i class="fas fa-arrow-left me-2"></i>Annuler
					</button>
					<button class="btn btn-primary-custom btn-custom" type="submit">
						<i class="fas fa-save me-2"></i>
						{{ button_label|default('Enregistrer') }}
					</button>
				</div>
				{{ form_end(form) }}
			</div>
		</div>
	</div>

	<!-- Historique du traitement -->
	<div class="row mt-4">
		<div class="col-12">
			<div class="info-card">
				<div class="card-header">
					<i class="fas fa-history"></i>
					Historique du traitement
				</div>
				<div class="card-body p-0">
					<div class="table-responsive">
						<table class="table history-table mb-0">
							<thead>
								<tr>
									<th>
										<i class="fas fa-tag me-2"></i>Motif</th>
									<th>
										<i class="fas fa-calendar me-2"></i>Date</th>
									<th>
										<i class="fas fa-comment me-2"></i>Commentaire</th>
								</tr>
							</thead>
							<tbody>
								{% for relance in sav.relanceSavs %}
									<tr>
										<td>
											{% if relance.motifRelance is null %}
												<span class="status-badge status-autre">
													<i class="fas fa-question me-1"></i>
													Autre Relance
												</span>
											{% elseif relance.motifRelance == 1 %}
												<span class="status-badge status-documents">
													<i class="fas fa-calendar-check me-1"></i>
													RDV
												</span>
											{% elseif relance.motifRelance == 2 %}
												<span class="status-badge status-avenant">
													<i class="fas fa-clock me-1"></i>
													Attente doc
												</span>
											{% elseif relance.motifRelance == 3 %}
												<span class="status-badge status-remboursement">
													<i class="fas fa-reply me-1"></i>
													Attente réponse CIE
												</span>
											{% elseif relance.motifRelance == 4 %}
												<span class="status-badge status-sinistre">
													<i class="fas fa-check-circle me-1"></i>
													Clôture
												</span>
											{% endif %}
										</td>
										<td>{{ relance.creatAt ? relance.creatAt|date('d/m/Y, H:i:s') : '' }}</td>
										<td>{{ relance.comment }}</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>{% endblock %}
