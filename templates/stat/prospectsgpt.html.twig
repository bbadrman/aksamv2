{% extends 'base.html.twig' %}

{% block title %}Liste des Prospects
{% endblock %}

{% block body %}
	<div class="container mt-4">
		<div class="d-flex justify-content-between align-items-center mb-4">
			<h1>Liste des Prospects</h1>
			<a href="{{ path('app_search_dates') }}" class="btn btn-outline-secondary">
				<i class="fas fa-arrow-left"></i>
				Retour à la recherche
			</a>
		</div>
		<form method="get" class="row mb-4">
			<input type="hidden" name="startDate" value="{{ startDate }}">
			<input type="hidden" name="endDate" value="{{ endDate }}">

			<div class="col-md-2">
				<select name="team" class="form-select">
					<option value="">-- Équipe --</option>
					{% for team in teams %}
						<option value="{{ team.id }}" {% if selectedTeam == team.id %} selected {% endif %}>{{ team.name }}</option>
					{% endfor %}
				</select>
			</div>

			<div class="col-md-2">
				<select name="comrcl" class="form-select">
					<option value="">-- Commercial --</option>
					{% for comrcl in comrcls %}
						<option value="{{ comrcl.id }}" {% if selectedComrcl == comrcl.id %} selected {% endif %}>{{ comrcl.username }}</option>
					{% endfor %}
				</select>
			</div>

			<div class="col-md-2">
				<select name="product" class="form-select">
					<option value="">-- Produit --</option>
					{% for product in products %}
						<option value="{{ product.id }}" {% if selectedProduct == product.id %} selected {% endif %}>{{ product.nom }}</option>
					{% endfor %}
				</select>
			</div>

			<div class="col-md-2">
				<input type="text" name="url" class="form-control" placeholder="URL" value="{{ selectedUrl }}">
			</div>

			<div class="col-md-2">
				<input type="text" name="activites" class="form-control" placeholder="Activités" value="{{ selectedActivites }}">
			</div>

			<div class="col-md-2">
				<input type="text" name="typeProspect" class="form-control" placeholder="Type prospect" value="{{ selectedTypeProspect }}">
			</div>

			<div class="col-md-12 mt-2">
				<button type="submit" class="btn btn-primary w-100">Filtrer</button>
			</div>
		</form>

		<div class="card mb-4">
			<div class="card-header bg-success text-white">
				<h5>Prospects pour la période du
					{{ startDate|date('d/m/Y') }}
					au
					{{ endDate|date('d/m/Y') }}</h5>
			</div>
			<div class="card-body">
				{% if prospects|length > 0 %}
					<div class="table-responsive">
						<table class="table table-bordered table-striped">
							<thead class="table-light">
								<tr>
									<th>Nom</th>
									<th>Prénom</th>
									<th>Date de création</th>
									<th>Téléphone</th>
									<th>Email</th>
									<th>Équipe</th>
								</tr>
							</thead>
							<tbody>
								{% for prospect in prospects %}
									<tr>
										<td>{{ prospect.nom }}</td>
										<td>{{ prospect.prenom }}</td>
										<td>{{ prospect.creatAt|date('d/m/Y') }}</td>
										<td>{{ prospect.gsm }}</td>
										<td>{{ prospect.email }}</td>
										<td>{{ prospect.team ? prospect.team.name : 'N/A' }}</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				{% else %}
					<div class="alert alert-info">
						Aucun prospect trouvé pour cette période.
					</div>
				{% endif %}
			</div>
		</div>

		<div class="row mb-4">
			<div class="col-12">
				<a href="{{ path('app_contrats', {'startDate': startDate, 'endDate': endDate}) }}" class="btn btn-info w-100">
					<i class="fas fa-file-contract"></i>
					Voir les contrats pour cette période
				</a>
			</div>
		</div>
	</div>
{% endblock %}
