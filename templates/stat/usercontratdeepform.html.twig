{% extends 'base.html.twig' %}

{% block title %}Hello StatController!
{% endblock %}

{% block body %}
	<section class="content-header">

		<h2>Statistique
		</h2>

		<ol class="breadcrumb">
			<li>
				<a href="{{ path('app_home') }}">
					<i class="fa fa-dashboard"></i>
					Tableau de bord</a>
			</li>
			{# <li class="active">
																																																																																																																																																																																																																																																																																																																																																																																																																																																	<a href="{{ path('app_table_liste') }}">
																																																																																																																																																																																																																																																																																																																																																																																																																																																		<i class="fa fa-users"></i>
																																																																																																																																																																																																																																																																																																																																																																																																																																																		Toutes les Tables</a>
																																																																																																																																																																																																																																																																																																																																																																																																																																																</li> #}
			<!-- NOTIFICATION DROPDOWN -->

			<li id="header_notification_bar" class="dropdown">
				<a data-toggle="dropdown" class="dropdown-toggle" href="#">
					<i class="fa fa-shopping-cart"></i>

				</a>

			</li>
			<!-- END NOTIFICATION DROPDOWN -->
		</ol>
		<br>
	</section>
	{{ form_start(form, {'attr': {'class': 'filter-form'}, 'method': 'GET'}) }}
	<div class="row g-3">
		<div class="col-md-3">
			{{ form_row(form.team, {'attr': {'class': 'form-select'}}) }}
		</div>
		<div class="col-md-3">
			{{ form_row(form.user, {'attr': {'class': 'form-select'}}) }}
		</div>
		<div class="col-md-3">
			{{ form_row(form.partenaire, {'attr': {'class': 'form-select'}}) }}
		</div>
		<div class="col-md-3">
			{{ form_row(form.startDate, {'attr': {'class': 'form-control'}}) }}
		</div>
		<div class="col-md-3">
			{{ form_row(form.endDate, {'attr': {'class': 'form-control'}}) }}
		</div>
		<div class="col-md-3">
			<button type="submit" class="btn btn-primary w-100">Filtrer</button>
		</div>
	</div>
	{{ form_end(form) }}
	{# Template Twig #}
	{% if teamData is not empty %}
		<table class="table table-bordered">
			<thead>
				<tr>
					<th>Équipe</th>
					<th>Comercial</th>
					<th>Partenaire</th>
					<th>Contrats</th>
					<th>Cotisation</th>
				</tr>
			</thead>
			<tbody>
				{% for teamEntry in teamData %}
					{% set firstUser = true %}

					{% for userEntry in teamEntry.users %}
						{% set firstPartner = true %}

						{% for nom, details in userEntry.partenaires %}
							<tr>
								{% if firstUser and firstPartner %}
									<td rowspan="{{ teamEntry.totalRows }}">{{ teamEntry.team.name }}</td>
								{% endif %}

								{% if firstPartner %}
									<td rowspan="{{ userEntry.rowspan }}">{{ userEntry.user.username }}</td>
								{% endif %}

								<td>{{ details.partenaire.nom }}</td>
								<td>{{ details.count }}</td>
								<td>{{ details.cotisation|number_format(2, ',', ' ') }}
									€</td>
							</tr>

							{% set firstPartner = false %}
							{% set firstUser = false %}
						{% endfor %}
					{% endfor %}
				{% endfor %}
			</tbody>
		</table>
	{% else %}
		<div class="alert alert-warning mt-3">
			Aucun résultat trouvé avec ces critères de recherche.
		</div>
	{% endif %}
{% endblock %}
