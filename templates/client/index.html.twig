{% extends 'base.html.twig' %}

{% block title %}Client index
{% endblock %}

{% block body %}
{% for label, messages in app.flashes %}
	<div class="container">
		<div class="alert alert-{{ label }}">
			{% for message in messages %}
				{{ message | raw }}
			{% endfor %}
		</div>
	</div>
{% endfor %}

<section class="content-header">
	<h2>Clients</h2>
	<ol class="breadcrumb">
		<li>
			<a href="{{ path('app_home') }}">
				<i class="fa fa-dashboard"></i>
				Tableau de bord</a>
		</li>
		<li class="active">
			<a href="{{ path('client_index') }}">
				<i class="fa fa-object-fonction"></i>
				Tous les clients</a>
		</li>
	</ol>
</section>
<div class="col-xs-12 mx-auto d-flex justify-content-center">

	<div class="row" style="margin-right: 12px;  ">

		{% include 'client/_search_form.html.twig' with {search_form: search_form} only %}
	</div>
</div>
<div class="row mt">
	<div class="col-lg-12">
		<div class="content-panel">
			<table class="table table-striped table-advance table-hover">
				<thead>
					<tr>
						<th>Equipe</th>
						<th>Commercial</th>
						<th>Nom</th>
						<th>Prenom</th>
						<th>Phone</th>
						<th>Email</th>
						<th>RaisonSociale</th>
						<th>Adress</th>
						<th>CreatAt</th>
						<th>Forme Juridique</th>
						<th style="text-align:center;">Nbr Contrat</th>
						<th>actions</th>
					</tr>
				</thead>
				<tbody>
					{% for client in clients %}
						<tr class="expandable-row client-row">
							<td>{{ client.team }}</td>
							<td>{{ client.cmrcl }}</td>
							<td>{{ client.nom }}</td>
							<td>{{ client.prenom }}</td>
							<td>{{ client.phone }}</td>
							<td>{{ client.email }}</td>
							<td>{{ client.raisonSociale }}</td>
							<td>{{ client.adress }}</td>
							<td>{{ client.creatAt ? client.creatAt|date('Y-m-d H:i ') : '' }}</td>
							{# <td>{{ client.isModifie ? 'Yes' : 'No' }}</td> #}
							<td>
								{% if  client.forceJuridique is null %}

									{% elseif client.forceJuridique == 1%}
										SARL
									{% elseif client.forceJuridique == 2%}
										EI
									{% elseif client.forceJuridique == 3%}
										EURL
									{% elseif client.forceJuridique == 4%}
										SA
									{% elseif client.forceJuridique == 5%}
										SAS
									{% elseif client.forceJuridique == 6%}
										SASU
									{% elseif client.forceJuridique == 7%}
										SNC
									{% elseif client.forceJuridique == 8%}
										SCOP
									{% elseif client.forceJuridique == 9%}
										Association
								{% endif %}


							</td>
							<td style="text-align:center;">
								{{ client.contrats|filter(contrat => contrat.status == 1)|length }}</td>
							<td class="btn-toolbar">

								{% if client.status == 1   %}
									<a href="{{ path('app_contrat_new', {'id': client.id}) }}" class="btn btn-success btn-xs">
										CONTART
									</a>
								{% elseif client.status == 2 %}
									{% if app.user  == client.cmrl %}
										<a href="{{ path('client_valide_edit', {'id': client.id}) }}" class="btn btn-danger btn-xs">
											REJETER
										</a>
									{% elseif  client.isModif == 1 %}
										<a href="{{ path('app_client_edit', {'id': client.id}) }}" class="btn btn btn-xs" style="background-color:#98FB98;">
											MODIFIE
										</a>

									{% else %}
										<a href="{{ path('app_client_edit', {'id': client.id}) }}" class="btn btn-danger btn-xs">
											REJETER
										</a>
									{% endif %}


								{% elseif  client.status is null %}
									{% if  is_granted('ROLE_ADMIN') and app.user  == client.cmrcl  %}
										<a href="{{ path('client_valide_edit', {'id': client.id}) }}" class="btn btn-success btn-xs">
											MYCLIENT
										</a>
									{% else %}
										{%  if  is_granted('ROLE_ADMIN')  %}
											<a href="{{ path('app_client_edit', {'id': client.id}) }}" class="btn btn-primary btn-xs">
												NOUVEAU
											</a>
										{% else %}
											En verification
										{% endif %}
									{% endif %}
								{% endif %}
								{%  if  is_granted('ROLE_ADMIN')  %}
									<a href="{{ path('client_valide_edit', {'id': client.id}) }}" class="btn btn-primary btn-xs">
										<i class="fa fa-pencil"></i>
									</a>
								{% endif %}
							</td>
						</tr>
						<tr class="expanded-content contract-row" style="display: none;">
							<td colspan="10">
								<table class="table table-bordered">
									<thead>
										<th>
											<i class="fa fa-handshake-o" aria-hidden="true"></i>
											CONTRAT</th>
										<th>Ã‰tat</th>
										<th>Commercial</th>
										<th>Produits</th>
										<th>Immatriculation</th>
										<th>Date d'Effet</th>
										<th>Date de Souscription</th>
										<th>Partenaire</th>
										<th>Compagnie</th>
										<th>Formule</th>
										<th>Cotisation</th>
										<th>Frais</th>
										<th>Actions</th>
									</thead>
									<tbody>
										{% for contrat in client.contrats|filter(contrat => contrat.status == 1)  %}
											<tr class="expandable-row contrat-row">
												<td style="color:blue;"></td>
												<td>{{ contrat.etat }}</td>
												<td>{{ contrat.user }}</td>
												<td>{{ contrat.product }}</td>
												<td>{{ contrat.imatriclt }}</td>
												<td>{{ contrat.dateEffet ? contrat.dateEffet|date('Y-m-d  ') : '' }}</td>
												<td>{{ contrat.dateSouscrpt ? contrat.dateSouscrpt|date('Y-m-d   ') : '' }}</td>

												<td>{{ contrat.formule }}</td>
												<td>{{ contrat.cotisation }}</td>
												<td>{{ contrat.frais }}</td>
												<td></td>
												<td></td>
												<td class="btn-toolbar">
													{{ render(controller('App\\Controller\\ContratController::paiement',{'id':contrat.id}))}}

													{{ render(controller('App\\Controller\\PaymentController::newpayment', {'id': contrat.id})) }}


												</td>
											</tr>
										</td>
									</tbody>
								</tr>
							{% endfor %}
						</tr>
					</tbody>
				</tbody>
			</td>
		</td>
	</tr>
</table>{% endfor %}</tbody></tbody></table><tfoot class="text-right"><tr><td colspan="9">{{ knp_pagination_render(clients, 'pagination.html.twig') }}</td></tr></tfoot></div></td></tr></div><script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script><script>$(document).ready(function () {
$('.client-row').click(function () {
$(this).next('.contract-row').toggle();
});

$('.contrat-row').click(function () {
$(this).next('.sav-row').toggle();
});
});</script></script> </script>{% endblock %}
